___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "iConvert Core Tracking",
  "categories": ["ANALYTICS", "CONVERSIONS", "PERSONALIZATION", "REMARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Integrate the iConvert core tracking tag to your website.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "iconvert_site_uuid",
    "displayName": "iConvert Site ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "A valid iConvert Site ID is required."
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "player_id",
    "displayName": "Player ID",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "notSetText": "To ensure that overlays do not fire for logged in players please set the unique player id / reference GTM variable."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const encodeUriComponent = require('encodeUriComponent');
const injectScript = require('injectScript');

const onSuccess = function() {
  log('iConvert: Core script loaded successfully.');
  data.gtmOnSuccess();
};

const onFailure = function() {
  log('iConvert: Core script load failed.');
  data.gtmOnFailure();
};

var player_id = (data.player_id) ? data.player_id : "";
var site_uuid = (data.iconvert_site_uuid) ? data.iconvert_site_uuid : "";

const params = "site_uuid=" + encodeUriComponent(site_uuid) + "&player_id=" + encodeUriComponent(player_id);
const gtmCoreWrapperUrl = "https://cdn.iconvert.network/code/gtm-core-0.0.1.js?"+params;

injectScript(gtmCoreWrapperUrl, onSuccess, onFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.iconvert.network/code/gtm-core*.js?site_uuid\u003d*\u0026player_id\u003d*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: injectScriptWasSuccessfulWhenCalledWithSiteIDAndPlayerID
  code: "const mockData = {\n  iconvert_site_uuid: \"1234-uuid-5678\",\n  player_id:\
    \ \"999999\",\n};\n\n\nmock('injectScript', (url, onSuccess, onFailure) => {\n\
    \tonSuccess();\n});\n\nrunCode(mockData);\n\nassertApi('injectScript').wasCalled();\n"
- name: injectScriptWasSuccessfulWhenCalledWithSiteIDAndEmptyPlayerID
  code: "const mockData = {\n  iconvert_site_uuid: \"1234-uuid-5678\",\n  player_id:\
    \ \"\",\n};\n\n\nmock('injectScript', (url, onSuccess, onFailure) => {\n\tonSuccess();\n\
    });\n\nrunCode(mockData);\n\nassertApi('injectScript').wasCalled();"
- name: injectScriptWasSuccessfulWhenCalledWithSiteIDAndUndefinedPlayerID
  code: "const mockData = {\n  iconvert_site_uuid: \"1234-uuid-5678\",\n};\n\n\nmock('injectScript',\
    \ (url, onSuccess, onFailure) => {\n\tonSuccess();\n});\n\nrunCode(mockData);\n\
    \nassertApi('injectScript').wasCalled();"


___NOTES___

Created on 21/02/2020, 12:20:10


